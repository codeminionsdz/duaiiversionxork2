# ๐ ุญุฏ ุฑูุน ุงููุตูุงุช ุงูุดูุฑู - ุฏููู ุณุฑูุน

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅุถุงูุฉ ูุธุงู ูุชุญุฏูุฏ ุนุฏุฏ ุงููุตูุงุช ุงูุชู ูููู ูููุณุชุฎุฏู ุฑูุนูุง ุดูุฑูุงู.

**ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ:**
- โ **ุงูุญุฏ ุงูุฃูุตู**: 5 ูุตูุงุช ุดูุฑูุงู ููู ูุณุชุฎุฏู
- โ **ุฅุนุงุฏุฉ ุงูุชุนููู**: ุชููุงุฆูุงู ูู ุฃูู ูู ุดูุฑ
- โ **ุงูุฑุณุงุฆู**: ุจุงููุบุฉ ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- โ **ุงูุญูุงูุฉ**: ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุง ูููู ุงูุชูุงุนุจ ุจูุง)

---

## ๐ ุฎุทูุงุช ุงูุชูุนูู

### 1๏ธโฃ ุชุดุบูู ุงูู Migration

ุงูุชุญ Supabase Dashboard โ SQL Editor ูุงูุชุจ:

```sql
-- ุงูุณุฎ ูุญุชูู ุงูููู ุงูุชุงูู ูุดุบูู:
-- scripts/022_prescription_monthly_limit.sql
```

ุฃู ูู ุงูู Terminal:

```bash
# ุฅุฐุง ูุงู ุนูุฏู Supabase CLI
supabase db reset
```

### 2๏ธโฃ ุงุฎุชุจุงุฑ ุงูููุฒุฉ

```bash
# ุดุบู ุงููุดุฑูุน
npm run dev

# ุงูุชุญ ุตูุญุฉ ุงูุฑูุน
# http://localhost:3000/upload

# ุฌุฑุจ ุฑูุน ูุตูุฉ ูุดูู ุงูุฑุณุงูุฉ ุงูุฎุถุฑุงุก ุชุธูุฑ
```

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### ูุจู ุฑูุน ุงููุตูุฉ:
```
1. ุงููุณุชุฎุฏู ูุฏุฎู ุตูุญุฉ ุงูุฑูุน
2. ูุธูุฑ ูู ุจุงูุฑ ููุถุญ ูู ูุตูุฉ ูุชุจููุฉ
3. ูุฎุชุงุฑ ุงูุตูุฑ ูููุชุจ ุงูููุงุญุธุงุช
4. ูุถุบุท "ุฑูุน ุงููุตูุฉ"
```

### ุฃุซูุงุก ุงูุฑูุน:
```
5. ุงููุธุงู ูุชุญูู ูู ุงูุญุฏ ุงูุดูุฑู
6. ุฅุฐุง ุชุฌุงูุฒ ุงูุญุฏ โ ูุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ ููููุน ุงูุฑูุน
7. ุฅุฐุง ูุง ุชุฌุงูุฒ โ ูููู ุงูุฑูุน ููุฒูุฏ ุงูุนุฏุงุฏ
```

### ุจุนุฏ ุงูุฑูุน ุงููุงุฌุญ:
```
8. ุงูุนุฏุงุฏ ูุฒูุฏ ุชููุงุฆูุงู
9. ุงูุจุงูุฑ ูุชุญุฏุซ ูููุถุญ ุงููุตูุงุช ุงููุชุจููุฉ
10. ูู ุฃูู ุงูุดูุฑ ุงูุฌุฏูุฏ โ ุงูุนุฏุงุฏ ูุฑุฌุน ุตูุฑ
```

---

## ๐จ ุดูู ุงููุงุฌูุฉ

### ุญุงูุฉ ุนุงุฏูุฉ (ูุณู ููู ูุตูุงุช ูุชุจููุฉ):
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ 3 ูุตูุงุช ูุชุจููุฉ ูุฐุง ุงูุดูุฑ      โ
โ                              2 / 5  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุชุญุฐูุฑ (ูุฑุจ ููุชูู ุงูุนุฏุฏ):
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ูุฏูู ูุตูุชุงู ููุท ูุชุจููุชุงู        โ
โ โโโโโโโโโโ 4 / 5                   โ
โ ๐ ุฅุนุงุฏุฉ ุงูุชุนููู: 1 ููุงูุฑ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ูุตูุช ููุญุฏ (ููููุน ุงูุฑูุน):
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ซ ููุฏ ูุตูุช ุฅูู ุงูุญุฏ ุงูุฃูุตู        โ
โ    (5 ูุตูุงุช) ููุฐุง ุงูุดูุฑ             โ
โ โโโโโโโโโโ 5 / 5                   โ
โ ๐ ุฅุนุงุฏุฉ ุงูุชุนููู: 1 ูุจุฑุงูุฑ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ๏ธ ุชุบููุฑ ุงูุฅุนุฏุงุฏุงุช

### ุชุบููุฑ ุงูุญุฏ ูู 5 ุฅูู ุฑูู ุขุฎุฑ:

ุงูุชุญ `scripts/022_prescription_monthly_limit.sql` ูุงุนุฏู ุงูุณุทุฑ:

```sql
-- ุบูุฑ ุงูุฑูู 5 ููุฑูู ุงููู ุชุจูู
IF current_count >= 5 THEN  -- ููุง
  RETURN FALSE;
END IF;
```

ุซู ุดุบู ุงูู SQL ูุฑุฉ ุซุงููุฉ.

---

## ๐ง ุฃุฏูุงุช ุงูุฅุฏุงุฑุฉ

### ุฅุนุงุฏุฉ ุชุนููู ุงูุนุฏุงุฏ ููุณุชุฎุฏู ูุนูู:

```sql
UPDATE profiles 
SET 
  prescriptions_this_month = 0,
  last_prescription_reset_date = CURRENT_DATE
WHERE email = 'user@example.com';
```

### ุดูู ุงููุณุชุฎุฏููู ุงููู ูุฑุจูุง ููุตููู ููุญุฏ:

```sql
SELECT 
  full_name,
  email,
  prescriptions_this_month,
  5 - prescriptions_this_month as ุงููุชุจูู
FROM profiles
WHERE prescriptions_this_month >= 3
ORDER BY prescriptions_this_month DESC;
```

### ุฅุญุตุงุฆูุงุช ุดูุฑูุฉ:

```sql
-- ูู ูุณุชุฎุฏู ูุตู ููุญุฏ ูุฐุง ุงูุดูุฑุ
SELECT COUNT(*) 
FROM profiles 
WHERE prescriptions_this_month >= 5 
  AND last_prescription_reset_date >= DATE_TRUNC('month', CURRENT_DATE);
```

---

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: ุงูุนุฏุงุฏ ูู ุฑุงุถู ูุฒูุฏ
**ุงูุญู:**
```sql
-- ุชุฃูุฏ ุฅู ุงูู Trigger ุดุบุงู
SELECT * FROM pg_trigger 
WHERE tgname = 'increment_prescription_count_trigger';

-- ุฅุฐุง ูู ููุฌูุฏุ ุดุบู ุงูู Migration ูุฑุฉ ุซุงููุฉ
```

### ุงููุดููุฉ: ุงูุจุงูุฑ ูู ุธุงูุฑ ูู ุงูุตูุญุฉ
**ุงูุญู:**
1. ุชุฃูุฏ ุฅูู ูุณุฌู ุฏุฎูู
2. ุฌุฑุจ ุฑูุน ูุตูุฉ ูุงุญุฏุฉ ุฃูู (ุงูุจุงูุฑ ูุฎุชูู ุฅุฐุง ุงูุนุฏุงุฏ = 0)
3. ุดูู ุงูู Console ูู ุงููุชุตูุญ ุฅุฐุง ููู errors

### ุงููุดููุฉ: ูุฏู ุฃุนุทู ุงูููุฒุฉ ูุคูุชุงู
**ุงูุญู:**
```typescript
// ูู app/upload/page.tsx ุงุญุฐู ูุฐุง ุงูุณุทุฑ:
<PrescriptionLimitBanner />

// ูุงุญุฐู ูุฐุง ุงูููุฏ ูู handleUpload:
const limitResponse = await fetch('/api/prescriptions/limit')
// ... ุงูุฎ
```

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ

1. **Database Schema**: `scripts/022_prescription_monthly_limit.sql`
   - ูุถูู ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ
   - ูุณูู Trigger ููุนุฏ ุงูุชููุงุฆู
   - ูุณูู Function ููุชุญูู

2. **API Endpoint**: `app/api/prescriptions/limit/route.ts`
   - ูุฑุฌุน ุญุงูุฉ ุงููุณุชุฎุฏู ุงูุญุงููุฉ
   - ูุดูู ูู ูุตูุฉ ุจุงููุฉ

3. **Utility Functions**: `lib/prescription-limit.ts`
   - ุฏูุงู ูุณุงุนุฏุฉ ููุชุญูู ูุงูุฅุฏุงุฑุฉ
   - ุฑุณุงุฆู ุจุงูุนุฑุจู ูุงูุฅูุฌููุฒู

4. **UI Component**: `components/prescription-limit-banner.tsx`
   - ุงูุจุงูุฑ ุงููู ูุธูุฑ ูู ุตูุญุฉ ุงูุฑูุน
   - ุฃููุงู ุชุชุบูุฑ ุญุณุจ ุงูุญุงูุฉ

5. **Integration**: `app/upload/page.tsx`
   - ุงูุชูุงูู ูุน ุตูุญุฉ ุงูุฑูุน
   - ููุน ุงูุฑูุน ุนูุฏ ุงููุตูู ููุญุฏ

---

## โ Checklist ูุจู ุงููุดุฑ

- [ ] ุดุบูุช ุงูู SQL Migration
- [ ] ุฌุฑุจุช ุฑูุน 5 ูุตูุงุช
- [ ] ุฌุฑุจุช ุฑูุน ุงูุณุงุฏุณุฉ (ูุงุฒู ุชูููุน)
- [ ] ุงูุจุงูุฑ ูุธูุฑ ุตุญ
- [ ] ุงูุฑุณุงุฆู ุจุงูุนุฑุจู ูุงุถุญุฉ
- [ ] ุดูุช ุงูู Console ูุงููู errors
- [ ] ุงุฎุชุจุฑุช ุนูู ุงูููุจุงูู

---

## ๐ฏ ููุงุฆุฏ ุงูููุฒุฉ

โ **ุญูุงูุฉ ูู ุงูุฅุณุงุกุฉ**: ููุน ุงููุณุชุฎุฏููู ูู ุฑูุน ูุตูุงุช ุจูุซุฑุฉ
โ **ุชูููุฑ ุงูุชุฎุฒูู**: ุชูููู ุงุณุชููุงู Supabase Storage
โ **ุชุฌุฑุจุฉ ุฃูุถู ููุตูุฏููุงุช**: ุนุฏุฏ ูุนููู ูู ุงูุทูุจุงุช
โ **ุชุญูู ุจุงูุชูุงููู**: Storage ู API calls ุฃูู
โ **ุฅุญุตุงุฆูุงุช ูุงุถุญุฉ**: ุชูุฏุฑ ุชุดูู ุงูุงุณุชุฎุฏุงู ุงูุดูุฑู

---

## ๐ ูุญุชุงุฌ ูุณุงุนุฏุฉุ

ุฑุงุฌุน ุงูููู ุงููุงูู: `PRESCRIPTION_LIMIT_SETUP.md`

ุฃู ุชูุงุตู ูุนูุง ุฅุฐุง ูุงุฌูุชู ูุดููุฉ!
